{"version":3,"file":"angulartics2-gst.js.map","sources":["ng://angulartics2/gst/gst.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\nimport { Angulartics2, GoogleGlobalSiteTagSettings } from 'angulartics2';\n\ndeclare var gtag: any;\ndeclare var ga: any;\n\nexport class GoogleGlobalSiteTagDefaults implements GoogleGlobalSiteTagSettings {\n  trackingIds = [];\n\n  constructor() {\n    if (typeof ga !== 'undefined' && ga) {\n      // See: https://developers.google.com/analytics/devguides/collection/analyticsjs/ga-object-methods-reference\n      ga.getAll().forEach((tracker) => {\n        const id = tracker.get('trackingId');\n        if (id !== undefined) {\n          this.trackingIds.push(id);\n        }\n      });\n    }\n  }\n}\n\n@Injectable()\nexport class Angulartics2GoogleGlobalSiteTag {\n\n  constructor(\n    protected angulartics2: Angulartics2,\n  ) {\n    const defaults = new GoogleGlobalSiteTagDefaults;\n    // Set the default settings for this module\n    this.angulartics2.settings.gst = { ...defaults, ...this.angulartics2.settings.gst };\n\n    this.angulartics2.pageTrack\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe((x) => this.pageTrack(x.path));\n    this.angulartics2.eventTrack\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe((x) => this.eventTrack(x.action, x.properties));\n    this.angulartics2.exceptionTrack\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe((x: any) => this.exceptionTrack(x));\n  }\n\n  /**\n   * Manually track page view, see:\n   *\n   * https://developers.google.com/analytics/devguides/collection/gtagjs/single-page-applications#tracking_virtual_pageviews\n   *\n   * @param path relative url\n   */\n  pageTrack(path: string) {\n    if (typeof gtag !== 'undefined' && gtag) {\n      for (const id of this.angulartics2.settings.gst.trackingIds) {\n        gtag('config', id, {'page_path': path});\n      }\n    }\n  }\n\n  /**\n   * Send interactions to gtag, i.e. for event tracking in Google Analytics. See:\n   *\n   * https://developers.google.com/analytics/devguides/collection/gtagjs/events\n   *\n   * @param action associated with the event\n   */\n  eventTrack(action: string, properties: any) {\n    // TODO: make interface\n    //  @param {string} properties.category\n    //  @param {string} [properties.label]\n    //  @param {number} [properties.value]\n    //  @param {boolean} [properties.noninteraction]\n    // Set a default GST category\n    properties = properties || {};\n\n    if (typeof gtag !== 'undefined' && gtag) {\n      gtag('event', action, {\n        event_category: properties.category || 'interaction',\n        event_label: properties.label,\n        value: properties.value,\n        non_interaction: properties.noninteraction,\n        ...properties.gstCustom\n      });\n    }\n  }\n\n  /**\n   * Exception Track Event in GST. See:\n   *\n   * https://developers.google.com/analytics/devguides/collection/gtagjs/exceptions\n   *\n   */\n  exceptionTrack(properties: any) {\n    // TODO: make interface\n    //  @param {Object} properties\n    //  @param {string} [properties.description]\n    //  @param {boolean} [properties.fatal]\n    if (properties.fatal === undefined) {\n      console.log('No \"fatal\" provided, sending with fatal=true');\n      properties.fatal = true;\n    }\n\n    properties.exDescription = properties.event ? properties.event.stack : properties.description;\n\n    this.eventTrack('exception', {\n      gstCustom: {\n        'description': properties.exDescription,\n        'fatal': properties.fatal,\n        ...properties.gstCustom\n      }\n    });\n  }\n}\n"],"names":[],"mappings":"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"}
